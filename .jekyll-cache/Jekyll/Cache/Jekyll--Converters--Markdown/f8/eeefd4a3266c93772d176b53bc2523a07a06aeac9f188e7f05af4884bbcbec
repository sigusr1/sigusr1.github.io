I"\«<ul id="markdown-toc">
  <li><a href="#ä¸€å®éªŒç¯å¢ƒ" id="markdown-toc-ä¸€å®éªŒç¯å¢ƒ">ä¸€ã€å®éªŒç¯å¢ƒ</a></li>
  <li><a href="#äºŒé¢„å¤‡çŸ¥è¯†" id="markdown-toc-äºŒé¢„å¤‡çŸ¥è¯†">äºŒã€é¢„å¤‡çŸ¥è¯†</a></li>
  <li><a href="#ä¸‰è™šæ‹Ÿå†…å­˜" id="markdown-toc-ä¸‰è™šæ‹Ÿå†…å­˜">ä¸‰ã€è™šæ‹Ÿå†…å­˜</a></li>
  <li><a href="#å››å‰–æä¸€ä¸ªç®€å•çš„cç¨‹åº" id="markdown-toc-å››å‰–æä¸€ä¸ªç®€å•çš„cç¨‹åº">å››ã€å‰–æä¸€ä¸ªç®€å•çš„Cç¨‹åº</a>    <ul>
      <li><a href="#strdup" id="markdown-toc-strdup">strdup</a></li>
      <li><a href="#è¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜ç©ºé—´å¤šå¤§" id="markdown-toc-è¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜ç©ºé—´å¤šå¤§">è¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜ç©ºé—´å¤šå¤§</a></li>
      <li><a href="#procæ–‡ä»¶ç³»ç»Ÿ" id="markdown-toc-procæ–‡ä»¶ç³»ç»Ÿ">procæ–‡ä»¶ç³»ç»Ÿ</a>        <ul>
          <li><a href="#memæ–‡ä»¶" id="markdown-toc-memæ–‡ä»¶">memæ–‡ä»¶</a></li>
          <li><a href="#mapsæ–‡ä»¶" id="markdown-toc-mapsæ–‡ä»¶">mapsæ–‡ä»¶</a></li>
        </ul>
      </li>
      <li><a href="#pid" id="markdown-toc-pid">pid</a></li>
    </ul>
  </li>
  <li><a href="#äº”æ›¿æ¢è¿›ç¨‹çš„å­—ç¬¦ä¸²" id="markdown-toc-äº”æ›¿æ¢è¿›ç¨‹çš„å­—ç¬¦ä¸²">äº”ã€æ›¿æ¢è¿›ç¨‹çš„å­—ç¬¦ä¸²</a>    <ul>
      <li><a href="#procæ¢ç©¶" id="markdown-toc-procæ¢ç©¶">/procæ¢ç©¶</a>        <ul>
          <li><a href="#procpidmaps" id="markdown-toc-procpidmaps">/proc/pid/maps</a></li>
          <li><a href="#heap" id="markdown-toc-heap">[heap]</a></li>
        </ul>
      </li>
      <li><a href="#æ›¿æ¢è™šæ‹Ÿå†…å­˜ä¸­çš„å­—ç¬¦ä¸²" id="markdown-toc-æ›¿æ¢è™šæ‹Ÿå†…å­˜ä¸­çš„å­—ç¬¦ä¸²">æ›¿æ¢è™šæ‹Ÿå†…å­˜ä¸­çš„å­—ç¬¦ä¸²###</a></li>
    </ul>
  </li>
  <li><a href="#å…­ä¸‹èŠ‚é¢„å‘Š" id="markdown-toc-å…­ä¸‹èŠ‚é¢„å‘Š">å…­ã€ä¸‹èŠ‚é¢„å‘Š</a></li>
  <li><a href="#ä¸ƒç»§ç»­é˜…è¯»" id="markdown-toc-ä¸ƒç»§ç»­é˜…è¯»">ä¸ƒã€ç»§ç»­é˜…è¯»</a></li>
  <li><a href="#å…«åŸæ–‡é“¾æ¥" id="markdown-toc-å…«åŸæ–‡é“¾æ¥">å…«ã€åŸæ–‡é“¾æ¥</a></li>
</ul>
<p>è¿™æ˜¯è™šæ‹Ÿå†…å­˜ç³»åˆ—æ–‡ç« çš„ç¬¬ä¸€ç¯‡ã€‚<br />
æœ¬æ–‡é€šè¿‡å®éªŒçš„æ‰‹æ®µï¼Œ å¸¦å¤§å®¶äº†è§£ä¸€äº›è®¡ç®—æœºç§‘å­¦ç›¸å…³çš„åŸºç¡€çŸ¥è¯†ã€‚ <br />
åœ¨æœ¬æ–‡ï¼Œæˆ‘ä»¬å°†åˆ©ç”¨<code class="highlighter-rouge">/proc</code>æŸ¥æ‰¾è¿›ç¨‹è™šæ‹Ÿå†…å­˜ä¸­çš„ASCIIå­—ç¬¦ä¸², ç„¶åä¿®æ”¹è¯¥å­—ç¬¦ä¸²ã€‚<br />
åœ¨è¿™ä¸€è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†å­¦åˆ°å¾ˆå¤šæœ‰è¶£çš„ä¸œè¥¿ã€‚</p>

<h2 id="ä¸€å®éªŒç¯å¢ƒ">ä¸€ã€å®éªŒç¯å¢ƒ</h2>
<p>æ‰€æœ‰çš„è„šæœ¬å’Œç¨‹åºéƒ½åœ¨ä¸‹é¢çš„ç¯å¢ƒä¸­æµ‹è¯•è¿‡ï¼š</p>

<ul>
  <li>Ubuntu 14.04 LTS
    <ul>
      <li>Linux ubuntu 4.4.0-31-generic #50~14.04.1-Ubuntu SMP Wed Jul 13 01:07:32 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux</li>
    </ul>
  </li>
  <li>gcc
    <ul>
      <li>gcc (Ubuntu 4.8.4-2ubuntu1~14.04.3) 4.8.4</li>
    </ul>
  </li>
  <li>Python 3
    <ul>
      <li>Python 3.4.3 (default, Nov 17 2016, 01:08:31)</li>
      <li>[GCC 4.8.4] on linux</li>
    </ul>
  </li>
</ul>

<h2 id="äºŒé¢„å¤‡çŸ¥è¯†">äºŒã€é¢„å¤‡çŸ¥è¯†</h2>
<p>é˜…è¯»æœ¬æ–‡æ‰€éœ€çŸ¥è¯†ï¼š</p>

<ul>
  <li>Cè¯­è¨€åŸºç¡€</li>
  <li>äº›è®¸PythonçŸ¥è¯†</li>
  <li>äº†è§£Linuxçš„æ–‡ä»¶ç³»ç»Ÿå’Œshellå‘½ä»¤</li>
</ul>

<h2 id="ä¸‰è™šæ‹Ÿå†…å­˜">ä¸‰ã€è™šæ‹Ÿå†…å­˜</h2>
<p>åœ¨è®¡ç®—æœºé¢†åŸŸï¼Œ è™šæ‹Ÿå†…å­˜æ˜¯é€šè¿‡è½¯ç¡¬ä»¶ç»“åˆå®ç°çš„ä¸€ç§å†…å­˜ç®¡ç†æŠ€æœ¯ï¼Œ å®ƒå°†ç¨‹åºæ‰€ä½¿ç”¨çš„å†…å­˜åœ°å€ï¼ˆè™šæ‹Ÿå†…å­˜åœ°å€ï¼‰æ˜ å°„åˆ°è®¡ç®—æœºçš„ç‰©ç†å†…å­˜ä¸Šï¼ˆç‰©ç†å†…å­˜åœ°å€ï¼‰ï¼Œè¿™ä½¿å¾—æ¯ä¸ªç¨‹åºçœ‹åˆ°çš„å†…å­˜åœ°å€ç©ºé—´éƒ½æ˜¯è¿ç»­çš„ï¼ˆæˆ–æ˜¯ä¸€äº›è¿ç»­åœ°å€ç©ºé—´çš„é›†åˆï¼‰ã€‚æ“ä½œç³»ç»Ÿç®¡ç†è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œ ä»¥åŠè™šæ‹Ÿåœ°å€ç©ºé—´åˆ°ç‰©ç†å†…å­˜çš„æ˜ å°„ã€‚CPUä¸­çš„åœ°å€è½¬æ¢ç¡¬ä»¶(é€šå¸¸è¢«ç§°ä¸ºå†…å­˜ç®¡ç†å•å…ƒ, MMU)è‡ªåŠ¨å°†è™šæ‹Ÿå†…å­˜åœ°å€è½¬æ¢æˆç‰©ç†å†…å­˜åœ°å€ã€‚æ“ä½œç³»ç»Ÿå¯ä»¥æä¾›æ¯”å®é™…ç‰©ç†å†…å­˜æ›´å¤šçš„è™šæ‹Ÿå†…å­˜ï¼Œè¿™ä¸€è¡Œä¸ºæ˜¯é€šè¿‡æ“ä½œç³»ç»Ÿä¸­çš„è½¯ä»¶æ¥å®ç°çš„ã€‚</p>

<p>è™šæ‹Ÿå†…å­˜çš„ä¸»è¦å¥½å¤„åŒ…å«ä»¥ä¸‹å‡ ç‚¹:</p>

<ul>
  <li>å°†åº”ç”¨ç¨‹åºä»å†…å­˜ç®¡ç†ä¸­è§£æ”¾å‡ºæ¥, åº”ç”¨ç¨‹åºåªéœ€å…³å¿ƒè‡ªå·±çš„é€»è¾‘</li>
  <li>ä¸åŒåº”ç”¨ç¨‹åºé—´çš„è™šæ‹Ÿå†…å­˜æ˜¯ç›¸äº’éš”ç¦»çš„, æ‰€ä»¥å®‰å…¨æ€§å¢åŠ äº†</li>
  <li>ç»“åˆå†…å­˜åˆ†é¡µç®¡ç†æŠ€æœ¯, åº”ç”¨ç¨‹åºç†è®ºä¸Šå¯ä½¿ç”¨æ¯”ç‰©ç†å†…å­˜æ›´å¤šçš„å†…å­˜ç©ºé—´</li>
</ul>

<p>æœ‰å…³è™šæ‹Ÿå†…å­˜çš„çŸ¥è¯†, å¯è¿›ä¸€æ­¥é˜…è¯»ç»´åŸºç™¾ç§‘ä¸Šçš„ç›¸å…³ä»‹ç»ï¼š<a href="https://en.wikipedia.org/wiki/Virtual_memory">è™šæ‹Ÿå†…å­˜</a>ã€‚</p>

<p>åœ¨<a href="http://blog.coderhuo.tech/2017/10/16/Virtual_Memory_drawing_VM_diagram/">è™šæ‹Ÿå†…å­˜æ¢ç©¶ â€“ ç¬¬ä¸‰ç¯‡:ä¸€æ­¥ä¸€æ­¥ç”»è™šæ‹Ÿå†…å­˜å›¾</a>ä¸­ï¼Œæˆ‘ä»¬å°†æ¢ç´¢è™šæ‹Ÿå†…å­˜çš„æ›´å¤šç»†èŠ‚ï¼Œå¹¶ä¸”çœ‹ä¸‹è™šæ‹Ÿå†…å­˜ä¸­éƒ½æœ‰äº›ä»€ä¹ˆï¼Œ ä»¥åŠè¿™äº›ä¸œè¥¿åˆ†åˆ«ä½äºè™šæ‹Ÿå†…å­˜çš„ä»€ä¹ˆåœ°æ–¹ã€‚</p>

<p>ç»§ç»­é˜…è¯»æœ¬æ–‡å‰, ä½ éœ€è¦çŸ¥é“ä»¥ä¸‹å‡ ç‚¹:</p>

<ul>
  <li>æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„è™šæ‹Ÿå†…å­˜</li>
  <li>è™šæ‹Ÿå†…å­˜å¤§å°ä¾èµ–äºè®¡ç®—æœºç³»ç»Ÿæ¶æ„</li>
  <li>ä¸åŒçš„æ“ä½œç³»ç»Ÿå¯¹è™šæ‹Ÿå†…å­˜çš„å¤„ç†ä¼šæœ‰æ‰€ä¸åŒ, å¯¹äºç°ä»£çš„å¤§å¤šæ•°æ“ä½œç³»ç»Ÿæ¥è¯´, è™šæ‹Ÿå†…å­˜å¦‚ä¸‹æ‰€ç¤º:</li>
</ul>

<p><img src="http://data.coderhuo.tech/blog/virtual_memory/virtual_memory.jpg" alt="è™šæ‹Ÿå†…å­˜ç¤ºæ„å›¾" /></p>

<p>åœ¨è™šæ‹Ÿå†…å­˜çš„é«˜åœ°å€ç©ºé—´ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°(ä¸‹é¢ä»…åˆ—å‡ºäº†éƒ¨åˆ†å†…å®¹ï¼Œå¹¶éå…¨éƒ¨)ï¼š</p>

<ul>
  <li>å‘½ä»¤è¡Œå‚æ•°å’Œç¯å¢ƒå˜é‡</li>
  <li>â€œå‘ä¸‹â€ç”Ÿé•¿çš„æ ˆã€‚å’‹çœ‹ä¹‹ä¸‹è¿™æ˜¯è¿åç›´è§‰çš„ï¼Œä½†è¿™ç¡®å®æ˜¯è™šæ‹Ÿå†…å­˜ä¸­æ ˆçš„å®ç°æ–¹å¼ã€‚</li>
</ul>

<p>åœ¨è™šæ‹Ÿå†…å­˜çš„ä½åœ°å€ç©ºé—´, æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š</p>

<ul>
  <li>å¯æ‰§è¡Œç¨‹åº(å®é™…ä¸Šè¿œæ¯”è¿™å¤æ‚ï¼Œä½†å¯¹äºç†è§£æœ¬æ–‡å‰©ä½™å†…å®¹è¶³å¤Ÿäº†)</li>
  <li>â€œå‘ä¸Šâ€ç”Ÿé•¿çš„å †</li>
</ul>

<p>å †æ˜¯è™šæ‹Ÿå†…å­˜çš„ä¸€éƒ¨åˆ†ï¼ŒåŠ¨æ€åˆ†é…çš„å†…å­˜(æ¯”å¦‚ç”¨mallocåˆ†é…çš„å†…å­˜)ä½äºå †ä¸­ã€‚</p>

<p>è¯·æ—¶åˆ»è®°ä½, <strong>è™šæ‹Ÿå†…å­˜å’Œç‰©ç†å†…å­˜æ˜¯ä¸åŒçš„</strong>ã€‚</p>

<h2 id="å››å‰–æä¸€ä¸ªç®€å•çš„cç¨‹åº">å››ã€å‰–æä¸€ä¸ªç®€å•çš„Cç¨‹åº</h2>

<p>æˆ‘ä»¬ä»ä¸€ä¸ªç®€å•çš„Cç¨‹åºå¼€å§‹:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;

/**
 * main - uses strdup to create a new string, and prints the
 * address of the new duplcated string
 *
 * Return: EXIT_FAILURE if malloc failed. Otherwise EXIT_SUCCESS
 */
int main(void)
{
    char *s;

    s = strdup("Holberton");
    if (s == NULL)
    {
        fprintf(stderr, "Can't allocate mem with malloc\n");
        return (EXIT_FAILURE);
    }
    printf("%p\n", (void *)s);
    return (EXIT_SUCCESS);
}
</code></pre></div></div>
<h3 id="strdup">strdup</h3>
<p>ç»§ç»­é˜…è¯»æœ¬æ–‡å‰ï¼Œè¯·æƒ³ä¸€æƒ³<code class="highlighter-rouge">strdup</code>æ˜¯å¦‚ä½•å¤åˆ¶å­—ç¬¦ä¸²<code class="highlighter-rouge">Holberton</code>çš„ï¼Ÿåˆè¯¥å¦‚ä½•è¯æ˜å‘¢ï¼Ÿ</p>

<p><strong>.</strong></p>

<p><strong>.</strong></p>

<p><strong>.</strong></p>

<p><code class="highlighter-rouge">strdup</code>å¿…é¡»åˆ›å»ºä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥å®ƒé¦–å…ˆä¼šä¸ºæ–°å­—ç¬¦ä¸²æ‰‹åˆ†é…å†…å­˜ï¼Œ å¹¶ä¸”å¯èƒ½ä½¿ç”¨<code class="highlighter-rouge">malloc</code>åˆ†é…å†…å­˜ã€‚è¿™å¯ä»¥é€šè¿‡<code class="highlighter-rouge">strdup</code>çš„manæ‰‹å†Œç¡®è®¤ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DESCRIPTION
       The  strdup()  function returns a pointer to a new string which is a duplicate of the string s.
       Memory for the new string is obtained with malloc(3), and can be freed with free(3).

</code></pre></div></div>

<p><em>ç­‰ç­‰ï¼ŒåŸºäºä¸Šæ–‡å…³äºè™šæ‹Ÿå†…å­˜çš„çŸ¥è¯†ï¼Œä½ è®¤ä¸ºæ–°åˆ›å»ºçš„å­—ç¬¦ä¸²ä½äºè™šæ‹Ÿå†…å­˜çš„å“ªé‡Œå‘¢ï¼Ÿæ˜¯é«˜åœ°å€ç©ºé—´è¿˜æ˜¯ä½åœ°å€ç©ºé—´ï¼Ÿ</em></p>

<p><strong>.</strong></p>

<p><strong>.</strong></p>

<p><strong>.</strong></p>

<p>åº”è¯¥æ˜¯ä½äºä½åœ°å€ç©ºé—´(å †ä¸­)ã€‚ä¸ºäº†éªŒè¯æˆ‘ä»¬çš„æ¨æ–­ï¼Œè®©æˆ‘ä»¬ç¼–è¯‘å¹¶æ‰§è¡Œè¿™ä¸ªCç¨‹åºï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
julien@holberton:~/holberton/w/hackthevm0$ gcc -Wall -Wextra -pedantic -Werror main.c -o holberton
julien@holberton:~/holberton/w/hackthevm0$ ./holberton 
0x1822010
julien@holberton:~/holberton/w/hackthevm0$ 

</code></pre></div></div>

<p>æ–°åˆ›å»ºçš„å­—ç¬¦ä¸²åœ°å€æ˜¯<code class="highlighter-rouge">0x1822010</code>ã€‚ä½†å®ƒç©¶ç«Ÿæ˜¯é«˜åœ°å€è¿˜æ˜¯ä½åœ°å€å‘¢ï¼Ÿ</p>

<h3 id="è¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜ç©ºé—´å¤šå¤§">è¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜ç©ºé—´å¤šå¤§</h3>

<p>è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´çš„å¤§å°ä¾èµ–äºè®¡ç®—æœºç³»ç»Ÿæ¶æ„ã€‚æˆ‘è¿è¡Œæœ¬ä¾‹ä½¿ç”¨çš„æ˜¯64ä½æœºå™¨ï¼Œæ‰€ä»¥ç†è®ºä¸Šæ¯ä¸ªè¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜æ˜¯2^64å­—èŠ‚ï¼Œå†…å­˜æœ€é«˜åœ°å€æ˜¯<code class="highlighter-rouge">0xffffffffffffffff</code> (1.8446744e+19)ï¼Œæœ€ä½åœ°å€æ˜¯<code class="highlighter-rouge">0x0</code>ã€‚</p>

<p><code class="highlighter-rouge">0x1822010</code>å°äº<code class="highlighter-rouge">0xffffffffffffffff</code>ï¼Œæ‰€ä»¥æ–°å­—ç¬¦ä¸²å¯èƒ½æ˜¯ä½äºä½åœ°å€ã€‚å€ŸåŠ©<code class="highlighter-rouge">proc</code>æ–‡ä»¶ç³»ç»Ÿï¼Œæˆ‘ä»¬å¯ä»¥ç¡®è®¤è¿™ä¸€ç‚¹ã€‚</p>

<h3 id="procæ–‡ä»¶ç³»ç»Ÿ">procæ–‡ä»¶ç³»ç»Ÿ</h3>

<p>ç”±<code class="highlighter-rouge">man proc</code>å¯è§ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The proc filesystem is a pseudo-filesystem which provides an interface to kernel data structures.  It is commonly mounted at `/proc`.  Most of it is read-only, but some files allow kernel variables to be changed.
</code></pre></div></div>

<p><code class="highlighter-rouge">/proc</code>ç›®å½•åŒ…å«ä¸€ç³»åˆ—æ–‡ä»¶ï¼Œæˆ‘ä»¬åªå…³æ³¨å…¶ä¸­çš„ä¸¤ä¸ªï¼š</p>

<ul>
  <li><code class="highlighter-rouge">/proc/[pid]/mem</code></li>
  <li><code class="highlighter-rouge">/proc/[pid]/maps</code></li>
</ul>

<h4 id="memæ–‡ä»¶">memæ–‡ä»¶</h4>

<p>ç”±<code class="highlighter-rouge">man proc</code>å¯è§ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      /proc/[pid]/mem
              This file can be used to access the pages of a process's memory
          through open(2), read(2), and lseek(2).
</code></pre></div></div>
<p>å¤ªæ£’äº†ï¼å¦‚æ­¤çœ‹æ¥ï¼Œ æˆ‘ä»¬å¯ä»¥è®¿é—®å¹¶ä¿®æ”¹ä»»ä¸€è¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜ã€‚</p>

<h4 id="mapsæ–‡ä»¶">mapsæ–‡ä»¶</h4>

<p>ç”±<code class="highlighter-rouge">man proc</code>å¯è§ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      /proc/[pid]/maps
              A  file containing the currently mapped memory regions and their access permissions.
          See mmap(2) for some further information about memory mappings.

              The format of the file is:

       address           perms offset  dev   inode       pathname
       00400000-00452000 r-xp 00000000 08:02 173521      /usr/bin/dbus-daemon
       00651000-00652000 r--p 00051000 08:02 173521      /usr/bin/dbus-daemon
       00652000-00655000 rw-p 00052000 08:02 173521      /usr/bin/dbus-daemon
       00e03000-00e24000 rw-p 00000000 00:00 0           [heap]
       00e24000-011f7000 rw-p 00000000 00:00 0           [heap]
       ...
       35b1800000-35b1820000 r-xp 00000000 08:02 135522  /usr/lib64/ld-2.15.so
       35b1a1f000-35b1a20000 r--p 0001f000 08:02 135522  /usr/lib64/ld-2.15.so
       35b1a20000-35b1a21000 rw-p 00020000 08:02 135522  /usr/lib64/ld-2.15.so
       35b1a21000-35b1a22000 rw-p 00000000 00:00 0
       35b1c00000-35b1dac000 r-xp 00000000 08:02 135870  /usr/lib64/libc-2.15.so
       35b1dac000-35b1fac000 ---p 001ac000 08:02 135870  /usr/lib64/libc-2.15.so
       35b1fac000-35b1fb0000 r--p 001ac000 08:02 135870  /usr/lib64/libc-2.15.so
       35b1fb0000-35b1fb2000 rw-p 001b0000 08:02 135870  /usr/lib64/libc-2.15.so
       ...
       f2c6ff8c000-7f2c7078c000 rw-p 00000000 00:00 0    [stack:986]
       ...
       7fffb2c0d000-7fffb2c2e000 rw-p 00000000 00:00 0   [stack]
       7fffb2d48000-7fffb2d49000 r-xp 00000000 00:00 0   [vdso]

              The address field is the address space in the process that the mapping occupies.
          The perms field is a set of permissions:

                   r = read
                   w = write
                   x = execute
                   s = shared
                   p = private (copy on write)

              The offset field is the offset into the file/whatever;
          dev is the device (major:minor); inode is the inode on that device.   0  indicates
              that no inode is associated with the memory region,
          as would be the case with BSS (uninitialized data).

              The  pathname field will usually be the file that is backing the mapping.
          For ELF files, you can easily coordinate with the offset field
              by looking at the Offset field in the ELF program headers (readelf -l).

              There are additional helpful pseudo-paths:

                   [stack]
                          The initial process's (also known as the main thread's) stack.

                   [stack:&lt;tid&gt;] (since Linux 3.4)
                          A thread's stack (where the &lt;tid&gt; is a thread ID).
              It corresponds to the /proc/[pid]/task/[tid]/ path.

                   [vdso] The virtual dynamically linked shared object.

                   [heap] The process's heap.

              If the pathname field is blank, this is an anonymous mapping as obtained via the mmap(2) function.
          There is no easy  way  to  coordinate
              this back to a process's source, short of running it through gdb(1), strace(1), or similar.

              Under Linux 2.0 there is no field giving pathname.
</code></pre></div></div>
<p>è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥é€šè¿‡æ–‡ä»¶<code class="highlighter-rouge">/proc/[pid]/mem</code>æ‰¾åˆ°ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹çš„å †ã€‚å¦‚æœå¯ä»¥è¯»å–å †å†…å®¹ï¼Œæˆ‘ä»¬å°±èƒ½æ‰¾åˆ°æƒ³è¦ä¿®æ”¹çš„å­—ç¬¦ä¸²ã€‚å¦‚æœèƒ½å¤Ÿå¾€å †ä¸­å†™æ•°æ®ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œå­—ç¬¦ä¸²æ›¿æ¢ã€‚</p>

<h3 id="pid">pid</h3>

<p>è¿›ç¨‹æ˜¯å¯æ‰§è¡Œç¨‹åºçš„ä¸€ä¸ªå®ä¾‹ï¼Œæ‹¥æœ‰ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„è¿›ç¨‹IDï¼ˆPID)ã€‚æœ‰äº›å‡½æ•°/ç³»ç»Ÿè°ƒç”¨ä½¿ç”¨PIDæ“ä½œè¿›ç¨‹æˆ–è€…å’Œè¿›ç¨‹è¿›è¡Œäº¤äº’ã€‚</p>

<p>å¯ä»¥é€šè¿‡å‘½ä»¤<code class="highlighter-rouge">ps</code>æ¥æŸ¥çœ‹æŸä¸ªè¿›ç¨‹çš„pidï¼ˆå…·ä½“è¯·å‚é˜…<code class="highlighter-rouge">man ps</code>)ã€‚</p>

<h2 id="äº”æ›¿æ¢è¿›ç¨‹çš„å­—ç¬¦ä¸²">äº”ã€æ›¿æ¢è¿›ç¨‹çš„å­—ç¬¦ä¸²</h2>
<p>æˆ‘ä»¬æ¥ä¸‹æ¥è¦åœ¨ä¸€ä¸ªè¿›ç¨‹çš„å †ä¸­æœç´¢ç‰¹å®šå­—ç¬¦ä¸²ï¼Œå¹¶ç”¨å¦ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆé•¿åº¦ä¸å¤§äºåŸå­—ç¬¦ä¸²ï¼‰æ›¿æ¢å®ƒã€‚ ç°åœ¨æˆ‘ä»¬å·²ç»æŒæ¡äº†æ‰€éœ€è¦çš„ç†è®ºçŸ¥è¯†ã€‚</p>

<p>ä¸‹é¢è¿™ä¸ªç¨‹åºæ˜¯æˆ‘ä»¬å°†è¦hackçš„ç¨‹åºï¼Œæ­£å¸¸æƒ…å†µä¸‹å®ƒå¾ªç¯è¾“å‡ºå­—ç¬¦ä¸²<code class="highlighter-rouge">Holberton</code>ã€‚</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#include &lt;unistd.h&gt;

/**              
 * main - uses strdup to create a new string, loops forever-ever
 *                
 * Return: EXIT_FAILURE if malloc failed. Other never returns
 */
int main(void)
{
     char *s;
     unsigned long int i;

     s = strdup("Holberton");
     if (s == NULL)
     {
          fprintf(stderr, "Can't allocate mem with malloc\n");
          return (EXIT_FAILURE);
     }
     i = 0;
     while (s)
     {
          printf("[%lu] %s (%p)\n", i, s, (void *)s);
          sleep(1);
          i++;
     }
     return (EXIT_SUCCESS);
}
</code></pre></div></div>

<p>ç¼–è¯‘è¿è¡Œè¯¥ç¨‹åºï¼Œå®ƒå°†å¾ªç¯è¾“å‡ºå­—ç¬¦ä¸²<code class="highlighter-rouge">Holberton</code>ç›´åˆ°è¿›ç¨‹è¢«æ€æ­»ã€‚</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>julien@holberton:~/holberton/w/hackthevm0$ gcc -Wall -Wextra -pedantic -Werror loop.c -o loop
julien@holberton:~/holberton/w/hackthevm0$ ./loop 
[0] Holberton (0xfbd010)
[1] Holberton (0xfbd010)
[2] Holberton (0xfbd010)
[3] Holberton (0xfbd010)
[4] Holberton (0xfbd010)
[5] Holberton (0xfbd010)
[6] Holberton (0xfbd010)
[7] Holberton (0xfbd010)
...
</code></pre></div></div>
<p>æ„Ÿå…´è¶£çš„è¯ï¼Œä½ å¯ä»¥æš‚åœé˜…è¯»æœ¬æ–‡ï¼Œå°è¯•å†™ä¸ªè„šæœ¬/ç¨‹åºå¯»æ‰¾è¿›ç¨‹å †ä¸­çš„å­—ç¬¦ä¸²ã€‚</p>

<p><strong>.</strong></p>

<p><strong>.</strong></p>

<p><strong>.</strong></p>

<h3 id="procæ¢ç©¶">/procæ¢ç©¶</h3>

<p>é¦–å…ˆè¿è¡Œåˆšæ‰ç¼–è¯‘å‡ºæ¥çš„å¯æ‰§è¡Œç¨‹åº<code class="highlighter-rouge">loop</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>julien@holberton:~/holberton/w/hackthevm0$ ./loop 
[0] Holberton (0x10ff010)
[1] Holberton (0x10ff010)
[2] Holberton (0x10ff010)
[3] Holberton (0x10ff010)
...
</code></pre></div></div>

<p>ç„¶åæ‰¾åˆ°è¿™ä¸ªè¿›ç¨‹çš„ID</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>julien@holberton:~/holberton/w/hackthevm0$ ps aux | grep ./loop | grep -v grep
julien     4618  0.0  0.0   4332   732 pts/14   S+   17:06   0:00 ./loop
</code></pre></div></div>

<p>ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ è¿›ç¨‹IDæ˜¯4618ï¼ˆä¸åŒæœºå™¨ä¸Šä¸åŒæ—¶åˆ»è¿è¡Œä¾‹ç¨‹ï¼Œè¿›ç¨‹IDéƒ½å¯èƒ½ä¸åŒï¼‰ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å°†è¦æŸ¥çœ‹çš„æ–‡ä»¶<code class="highlighter-rouge">maps</code>å’Œ<code class="highlighter-rouge">mem</code>ä½äºç›®å½•<code class="highlighter-rouge">/proc/4618</code>:</p>

<ul>
  <li><code class="highlighter-rouge">/proc/4618/maps</code></li>
  <li><code class="highlighter-rouge">/proc/4618/mem</code></li>
</ul>

<p>åœ¨ç›®å½•<code class="highlighter-rouge">/proc/4618</code>ä¸‹æ‰§è¡Œ<code class="highlighter-rouge">ls -la</code>å¯ä»¥çœ‹åˆ°ä»¥ä¸‹å†…å®¹ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>julien@ubuntu:/proc/4618$ ls -la
total 0
dr-xr-xr-x   9 julien julien 0 Mar 15 17:07 .
dr-xr-xr-x 257 root   root   0 Mar 15 10:20 ..
dr-xr-xr-x   2 julien julien 0 Mar 15 17:11 attr
-rw-r--r--   1 julien julien 0 Mar 15 17:11 autogroup
-r--------   1 julien julien 0 Mar 15 17:11 auxv
-r--r--r--   1 julien julien 0 Mar 15 17:11 cgroup
--w-------   1 julien julien 0 Mar 15 17:11 clear_refs
-r--r--r--   1 julien julien 0 Mar 15 17:07 cmdline
-rw-r--r--   1 julien julien 0 Mar 15 17:11 comm
-rw-r--r--   1 julien julien 0 Mar 15 17:11 coredump_filter
-r--r--r--   1 julien julien 0 Mar 15 17:11 cpuset
lrwxrwxrwx   1 julien julien 0 Mar 15 17:11 cwd -&gt; /home/julien/holberton/w/funwthevm
-r--------   1 julien julien 0 Mar 15 17:11 environ
lrwxrwxrwx   1 julien julien 0 Mar 15 17:11 exe -&gt; /home/julien/holberton/w/funwthevm/loop
dr-x------   2 julien julien 0 Mar 15 17:07 fd
dr-x------   2 julien julien 0 Mar 15 17:11 fdinfo
-rw-r--r--   1 julien julien 0 Mar 15 17:11 gid_map
-r--------   1 julien julien 0 Mar 15 17:11 io
-r--r--r--   1 julien julien 0 Mar 15 17:11 limits
-rw-r--r--   1 julien julien 0 Mar 15 17:11 loginuid
dr-x------   2 julien julien 0 Mar 15 17:11 map_files
-r--r--r--   1 julien julien 0 Mar 15 17:11 maps
-rw-------   1 julien julien 0 Mar 15 17:11 mem
-r--r--r--   1 julien julien 0 Mar 15 17:11 mountinfo
-r--r--r--   1 julien julien 0 Mar 15 17:11 mounts
-r--------   1 julien julien 0 Mar 15 17:11 mountstats
dr-xr-xr-x   5 julien julien 0 Mar 15 17:11 net
dr-x--x--x   2 julien julien 0 Mar 15 17:11 ns
-r--r--r--   1 julien julien 0 Mar 15 17:11 numa_maps
-rw-r--r--   1 julien julien 0 Mar 15 17:11 oom_adj
-r--r--r--   1 julien julien 0 Mar 15 17:11 oom_score
-rw-r--r--   1 julien julien 0 Mar 15 17:11 oom_score_adj
-r--------   1 julien julien 0 Mar 15 17:11 pagemap
-r--------   1 julien julien 0 Mar 15 17:11 personality
-rw-r--r--   1 julien julien 0 Mar 15 17:11 projid_map
lrwxrwxrwx   1 julien julien 0 Mar 15 17:11 root -&gt; /
-rw-r--r--   1 julien julien 0 Mar 15 17:11 sched
-r--r--r--   1 julien julien 0 Mar 15 17:11 schedstat
-r--r--r--   1 julien julien 0 Mar 15 17:11 sessionid
-rw-r--r--   1 julien julien 0 Mar 15 17:11 setgroups
-r--r--r--   1 julien julien 0 Mar 15 17:11 smaps
-r--------   1 julien julien 0 Mar 15 17:11 stack
-r--r--r--   1 julien julien 0 Mar 15 17:07 stat
-r--r--r--   1 julien julien 0 Mar 15 17:11 statm
-r--r--r--   1 julien julien 0 Mar 15 17:07 status
-r--------   1 julien julien 0 Mar 15 17:11 syscall
dr-xr-xr-x   3 julien julien 0 Mar 15 17:11 task
-r--r--r--   1 julien julien 0 Mar 15 17:11 timers
-rw-r--r--   1 julien julien 0 Mar 15 17:11 uid_map
-r--r--r--   1 julien julien 0 Mar 15 17:11 wchan
</code></pre></div></div>

<h4 id="procpidmaps">/proc/pid/maps</h4>

<p>å¦‚ä¹‹å‰æ‰€è§ï¼Œæ–‡ä»¶<code class="highlighter-rouge">/proc/pid/maps</code>æ˜¯ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è¯»å–ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>julien@ubuntu:/proc/4618$ cat maps
00400000-00401000 r-xp 00000000 08:01 1070052                            /home/julien/holberton/w/funwthevm/loop
00600000-00601000 r--p 00000000 08:01 1070052                            /home/julien/holberton/w/funwthevm/loop
00601000-00602000 rw-p 00001000 08:01 1070052                            /home/julien/holberton/w/funwthevm/loop
010ff000-01120000 rw-p 00000000 00:00 0                                  [heap]
7f144c052000-7f144c20c000 r-xp 00000000 08:01 136253                     /lib/x86_64-linux-gnu/libc-2.19.so
7f144c20c000-7f144c40c000 ---p 001ba000 08:01 136253                     /lib/x86_64-linux-gnu/libc-2.19.so
7f144c40c000-7f144c410000 r--p 001ba000 08:01 136253                     /lib/x86_64-linux-gnu/libc-2.19.so
7f144c410000-7f144c412000 rw-p 001be000 08:01 136253                     /lib/x86_64-linux-gnu/libc-2.19.so
7f144c412000-7f144c417000 rw-p 00000000 00:00 0 
7f144c417000-7f144c43a000 r-xp 00000000 08:01 136229                     /lib/x86_64-linux-gnu/ld-2.19.so
7f144c61e000-7f144c621000 rw-p 00000000 00:00 0 
7f144c636000-7f144c639000 rw-p 00000000 00:00 0 
7f144c639000-7f144c63a000 r--p 00022000 08:01 136229                     /lib/x86_64-linux-gnu/ld-2.19.so
7f144c63a000-7f144c63b000 rw-p 00023000 08:01 136229                     /lib/x86_64-linux-gnu/ld-2.19.so
7f144c63b000-7f144c63c000 rw-p 00000000 00:00 0 
7ffc94272000-7ffc94293000 rw-p 00000000 00:00 0                          [stack]
7ffc9435e000-7ffc94360000 r--p 00000000 00:00 0                          [vvar]
7ffc94360000-7ffc94362000 r-xp 00000000 00:00 0                          [vdso]
ffffffffff600000-ffffffffff601000 r-xp 00000000 00:00 0                  [vsyscall]
</code></pre></div></div>

<p>å›æƒ³å‰é¢çš„å†…å®¹ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œæ ˆï¼ˆ<code class="highlighter-rouge">[stack]</code>)ä½äºå†…å­˜çš„é«˜åœ°å€ï¼Œå †ï¼ˆ<code class="highlighter-rouge">[heap]</code>)ä½äºå†…å­˜çš„ä½åœ°å€ã€‚</p>

<h4 id="heap">[heap]</h4>
<p>ä»<code class="highlighter-rouge">maps</code>æ–‡ä»¶ä¸­ï¼Œ æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°æœç´¢å­—ç¬¦ä¸²éœ€è¦çš„æ‰€æœ‰ä¿¡æ¯:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>010ff000-01120000 rw-p 00000000 00:00 0                                  [heap]
</code></pre></div></div>
<p>è¿™ä¸ªè¿›ç¨‹çš„å †ä¿¡æ¯å¦‚ä¸‹:</p>

<ul>
  <li>åœ¨è™šæ‹Ÿå†…å­˜ä¸­çš„èµ·å§‹åœ°å€æ˜¯<code class="highlighter-rouge">0x010ff000</code></li>
  <li>ç»“æŸåœ°å€æ˜¯<code class="highlighter-rouge">01120000</code></li>
  <li>æƒé™æ˜¯å¯è¯»å†™çš„ï¼ˆ<code class="highlighter-rouge">rw</code>ï¼‰</li>
</ul>

<p>å›é¡¾ä¸‹æ­£åœ¨è¿è¡Œçš„<code class="highlighter-rouge">loop</code>çš„è¾“å‡º:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
[1024] Holberton (0x10ff010)
...
</code></pre></div></div>

<p><code class="highlighter-rouge">0x010ff000</code> &lt; <code class="highlighter-rouge">0x10ff010</code> &lt; <code class="highlighter-rouge">0x01120000</code>ã€‚è¿™è¯æ˜äº†æˆ‘ä»¬çš„å­—ç¬¦ä¸²æ˜¯åœ¨å †ä¸Šã€‚æ›´ç²¾ç¡®çš„è¯´ï¼Œæ–°å­—ç¬¦ä¸²æ˜¯åœ¨å †åç§»<code class="highlighter-rouge">0x10</code>çš„åœ°æ–¹ã€‚å¦‚æœæˆ‘ä»¬æ‰“å¼€æ–‡ä»¶<code class="highlighter-rouge">/proc/4618/mem</code>å¹¶ä¸”å°†æ–‡ä»¶æŒ‡é’ˆç§»åŠ¨åˆ°<code class="highlighter-rouge">0x10ff010</code>ï¼Œ æˆ‘ä»¬å°±èƒ½æ›¿æ¢æ­£åœ¨è¿è¡Œçš„ç¨‹åº<code class="highlighter-rouge">loop</code>ä¸­çš„å­—ç¬¦ä¸²<code class="highlighter-rouge">Holberton</code>ã€‚</p>

<p>æˆ‘ä»¬æ¥ä¸‹æ¥ä¼šå†™ä¸ªç¨‹åº/è„šæœ¬åšè¿™ä»¶äº‹æƒ…ã€‚<br />
ä½ ä¹Ÿå¯ä»¥æš‚åœé˜…è¯»æœ¬æ–‡ï¼Œç”¨è‡ªå·±æœ€ç†Ÿæ‚‰çš„è¯­è¨€å°è¯•å†™ä¸ªè„šæœ¬/ç¨‹åºæ¥åšè¿™ä»¶äº‹æƒ…ã€‚</p>

<p><strong>.</strong></p>

<p><strong>.</strong></p>

<p><strong>.</strong></p>

<h3 id="æ›¿æ¢è™šæ‹Ÿå†…å­˜ä¸­çš„å­—ç¬¦ä¸²">æ›¿æ¢è™šæ‹Ÿå†…å­˜ä¸­çš„å­—ç¬¦ä¸²###</h3>
<p>ä¸‹é¢æ˜¯æˆ‘ä»¬ç”¨Python3 å®ç°å­—ç¬¦ä¸²æ›¿æ¢çš„è„šæœ¬(read_write_heap.py):</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
</span><span class="s">'''             
Locates and replaces the first occurrence of a string in the heap
of a process    

Usage: ./read_write_heap.py PID search_string replace_by_string
Where:           
- PID is the pid of the target process
- search_string is the ASCII string you are looking to overwrite
- replace_by_string is the ASCII string you want to replace
  search_string with
'''</span>

<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">def</span> <span class="nf">print_usage_and_exit</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Usage: {} pid search write'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># check usage  
</span><span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
    <span class="n">print_usage_and_exit</span><span class="p">()</span>

<span class="c1"># get the pid from args
</span><span class="n">pid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="k">if</span> <span class="n">pid</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">print_usage_and_exit</span><span class="p">()</span>
<span class="n">search_string</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="k">if</span> <span class="n">search_string</span>  <span class="o">==</span> <span class="s">""</span><span class="p">:</span>
    <span class="n">print_usage_and_exit</span><span class="p">()</span>
<span class="n">write_string</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
<span class="k">if</span> <span class="n">search_string</span>  <span class="o">==</span> <span class="s">""</span><span class="p">:</span>
    <span class="n">print_usage_and_exit</span><span class="p">()</span>

<span class="c1"># open the maps and mem files of the process
</span><span class="n">maps_filename</span> <span class="o">=</span> <span class="s">"/proc/{}/maps"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"[*] maps: {}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">maps_filename</span><span class="p">))</span>
<span class="n">mem_filename</span> <span class="o">=</span> <span class="s">"/proc/{}/mem"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"[*] mem: {}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">mem_filename</span><span class="p">))</span>

<span class="c1"># try opening the maps file
</span><span class="k">try</span><span class="p">:</span>
    <span class="n">maps_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'/proc/{}/maps'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">pid</span><span class="p">),</span> <span class="s">'r'</span><span class="p">)</span>
<span class="k">except</span> <span class="nb">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"[ERROR] Can not open file {}:"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">maps_filename</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"        I/O error({}): {}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">errno</span><span class="p">,</span> <span class="n">e</span><span class="p">.</span><span class="n">strerror</span><span class="p">))</span>
    <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">maps_file</span><span class="p">:</span>
    <span class="n">sline</span> <span class="o">=</span> <span class="n">line</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">' '</span><span class="p">)</span>
    <span class="c1"># check if we found the heap
</span>    <span class="k">if</span> <span class="n">sline</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s">"[heap]"</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"[*] Found [heap]:"</span><span class="p">)</span>

    <span class="c1"># parse line
</span>    <span class="n">addr</span> <span class="o">=</span> <span class="n">sline</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">perm</span> <span class="o">=</span> <span class="n">sline</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="n">sline</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">device</span> <span class="o">=</span> <span class="n">sline</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">inode</span> <span class="o">=</span> <span class="n">sline</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">pathname</span> <span class="o">=</span> <span class="n">sline</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="si">\</span><span class="se">t</span><span class="s">pathname = {}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">pathname</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="si">\</span><span class="se">t</span><span class="s">addresses = {}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">addr</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="si">\</span><span class="se">t</span><span class="s">permisions = {}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">perm</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="si">\</span><span class="se">t</span><span class="s">offset = {}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">offset</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="si">\</span><span class="se">t</span><span class="s">inode = {}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">inode</span><span class="p">))</span>

    <span class="c1"># check if there is read and write permission
</span>    <span class="k">if</span> <span class="n">perm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s">'r'</span> <span class="ow">or</span> <span class="n">perm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s">'w'</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"[*] {} does not have read/write permission"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">pathname</span><span class="p">))</span>
        <span class="n">maps_file</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
        <span class="nb">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># get start and end of the heap in the virtual memory
</span>    <span class="n">addr</span> <span class="o">=</span> <span class="n">addr</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">"-"</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span> <span class="c1"># never trust anyone, not even your OS :)
</span>        <span class="k">print</span><span class="p">(</span><span class="s">"[*] Wrong addr format"</span><span class="p">)</span>
        <span class="n">maps_file</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
        <span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">addr_start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">addr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span>
    <span class="n">addr_end</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">addr</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="si">\</span><span class="se">t</span><span class="s">Addr start [{:x}] | end [{:x}]"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">addr_start</span><span class="p">,</span> <span class="n">addr_end</span><span class="p">))</span>

    <span class="c1"># open and read mem
</span>    <span class="k">try</span><span class="p">:</span>
        <span class="n">mem_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">mem_filename</span><span class="p">,</span> <span class="s">'rb+'</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"[ERROR] Can not open file {}:"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">mem_filename</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"        I/O error({}): {}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">errno</span><span class="p">,</span> <span class="n">e</span><span class="p">.</span><span class="n">strerror</span><span class="p">))</span>
        <span class="n">maps_file</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
        <span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># read heap  
</span>    <span class="n">mem_file</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="n">addr_start</span><span class="p">)</span>
    <span class="n">heap</span> <span class="o">=</span> <span class="n">mem_file</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">addr_end</span> <span class="o">-</span> <span class="n">addr_start</span><span class="p">)</span>

    <span class="c1"># find string
</span>    <span class="k">try</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">heap</span><span class="p">.</span><span class="n">index</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">search_string</span><span class="p">,</span> <span class="s">"ASCII"</span><span class="p">))</span>
    <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Can't find '{}'"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">search_string</span><span class="p">))</span>
        <span class="n">maps_file</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">mem_file</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
        <span class="nb">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"[*] Found '{}' at {:x}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">search_string</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>

    <span class="c1"># write the new string
</span>    <span class="k">print</span><span class="p">(</span><span class="s">"[*] Writing '{}' at {:x}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">write_string</span><span class="p">,</span> <span class="n">addr_start</span> <span class="o">+</span> <span class="n">i</span><span class="p">))</span>
    <span class="n">mem_file</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="n">addr_start</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span>
    <span class="n">mem_file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">write_string</span><span class="p">,</span> <span class="s">"ASCII"</span><span class="p">))</span>

    <span class="c1"># close files
</span>    <span class="n">maps_file</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">mem_file</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c1"># there is only one heap in our example
</span>    <span class="k">break</span>
</code></pre></div></div>

<p>æ³¨æ„ï¼šéœ€è¦ä»¥rootæƒé™æ‰§è¡Œä¸Šé¢çš„è„šæœ¬ï¼Œ å¦åˆ™æ— æ³•è¯»å†™æ–‡ä»¶<code class="highlighter-rouge">/proc/pid/mem</code>ï¼Œ å³ä½¿ä½ æ˜¯è¿›ç¨‹çš„æ‰€æœ‰è€…ã€‚</p>

<p>è¿è¡Œä¸Šé¢çš„è„šæœ¬ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>julien@holberton:~/holberton/w/hackthevm0$ sudo ./read_write_heap.py 4618 Holberton "Fun w vm!"
[*] maps: /proc/4618/maps
[*] mem: /proc/4618/mem
[*] Found [heap]:
    pathname = [heap]
    addresses = 010ff000-01120000
    permisions = rw-p
    offset = 00000000
    inode = 0
    Addr start [10ff000] | end [1120000]
[*] Found 'Holberton' at 10
[*] Writing 'Fun w vm!' at 10ff010
julien@holberton:~/holberton/w/hackthevm0$ 
</code></pre></div></div>
<p>å¯ä»¥çœ‹åˆ°ä¸Šé¢è„šæœ¬æ‰“å°å‡ºæ¥çš„åœ°å€å’Œæˆ‘ä»¬æ‰‹åŠ¨æ‰¾åˆ°çš„æ˜¯ä¸€è‡´çš„:</p>

<ul>
  <li>è¿›ç¨‹çš„å †ä½äºè™šæ‹Ÿå†…å­˜çš„<code class="highlighter-rouge">0x010ff000</code> ~ <code class="highlighter-rouge">0x01120000</code></li>
  <li>æˆ‘ä»¬è¦æ‰¾çš„å­—ç¬¦ä¸²åœ°å€æ˜¯<code class="highlighter-rouge">0x10ff010</code>, ç›¸å¯¹äºå †çš„èµ·å§‹åœ°å€åç§»äº†<code class="highlighter-rouge">0x10</code></li>
</ul>

<p>å›è¿‡å¤´æ¥çœ‹ä¸‹æˆ‘ä»¬çš„<code class="highlighter-rouge">loop</code>ç¨‹åºï¼Œå®ƒåº”è¯¥ä¼šæ‰“å°å­—ç¬¦ä¸²â€fun w vm!â€</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
[2676] Holberton (0x10ff010)
[2677] Holberton (0x10ff010)
[2678] Holberton (0x10ff010)
[2679] Holberton (0x10ff010)
[2680] Holberton (0x10ff010)
[2681] Holberton (0x10ff010)
[2682] Fun w vm! (0x10ff010)
[2683] Fun w vm! (0x10ff010)
[2684] Fun w vm! (0x10ff010)
[2685] Fun w vm! (0x10ff010)
...
</code></pre></div></div>

<p><img src="https://s3-us-west-1.amazonaws.com/holbertonschool/medias/blown-mind-explosion-gif.gif" alt="å¤ªä¸å¯æ€è®®äº†!" /></p>

<h2 id="å…­ä¸‹èŠ‚é¢„å‘Š">å…­ã€ä¸‹èŠ‚é¢„å‘Š</h2>

<p>ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬è¦åšçš„äº‹æƒ…å’Œæœ¬ç« ç±»ä¼¼ï¼Œ ä¸åŒçš„æ˜¯æˆ‘ä»¬å°†è®¿é—®å¹¶ä¿®æ”¹ä¸€ä¸ªPython3 è„šæœ¬çš„å†…å­˜ã€‚ è¿™åšèµ·æ¥æ¯”è¾ƒåƒåŠ›ï¼Œ æ‰€ä»¥æˆ‘ä»¬éœ€è¦äº†è§£Pyhton3 å†…éƒ¨çš„ä¸€äº›æœºåˆ¶ã€‚ä¸ä¿¡ä½ å¯ä»¥è¯•è¯•ï¼Œä¸Šé¢çš„è„šæœ¬read_write_heap.pyå¹¶ä¸èƒ½ä¿®æ”¹Python3è¿›ç¨‹ä¸­çš„ASCIIå­—ç¬¦ä¸²ã€‚</p>

<h2 id="ä¸ƒç»§ç»­é˜…è¯»">ä¸ƒã€ç»§ç»­é˜…è¯»</h2>

<ul>
  <li>ç¬¬ä¸€ç¯‡:<a href="http://blog.coderhuo.tech/2017/10/12/Virtual_Memory_C_strings_proc/">è™šæ‹Ÿå†…å­˜æ¢ç©¶ â€“ ç¬¬ä¸€ç¯‡:C strings &amp; /proc</a></li>
  <li>ç¬¬äºŒç¯‡:<a href="http://blog.coderhuo.tech/2017/10/15/Virtual_Memory_python_bytes/">è™šæ‹Ÿå†…å­˜æ¢ç©¶ â€“ ç¬¬äºŒç¯‡:Python å­—èŠ‚</a></li>
  <li>ç¬¬ä¸‰ç¯‡:<a href="http://blog.coderhuo.tech/2017/10/16/Virtual_Memory_drawing_VM_diagram/">è™šæ‹Ÿå†…å­˜æ¢ç©¶ â€“ ç¬¬ä¸‰ç¯‡:ä¸€æ­¥ä¸€æ­¥ç”»è™šæ‹Ÿå†…å­˜å›¾</a></li>
  <li>ç¬¬å››ç¯‡:<a href="http://blog.coderhuo.tech/2017/10/18/Virtual_Memory_malloc_and_heap/">è™šæ‹Ÿå†…å­˜æ¢ç©¶ â€“ ç¬¬å››ç¯‡:malloc, heap &amp; the program break</a></li>
  <li>ç¬¬äº”ç¯‡:<a href="http://blog.coderhuo.tech/2019/08/31/Virtual_Memory_malloc_and_heap_stack_and_register/">è™šæ‹Ÿå†…å­˜æ¢ç©¶ â€“ ç¬¬äº”ç¯‡:The Stack, registers and assembly code</a></li>
</ul>

<h2 id="å…«åŸæ–‡é“¾æ¥">å…«ã€åŸæ–‡é“¾æ¥</h2>
<p><a href="https://blog.holbertonschool.com/hack-the-virtual-memory-c-strings-proc/">Hack The Virtual Memory: C strings &amp; /proc</a></p>
:ET